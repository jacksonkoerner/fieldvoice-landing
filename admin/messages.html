<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FieldVoice Pro â€” Communications Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f1d32; color: #e2e8f0; margin: 0; }
        .safety-stripe { height: 6px; background: repeating-linear-gradient(-45deg, #f59e0b, #f59e0b 10px, #0a1628 10px, #0a1628 20px); }
        .sidebar { width: 260px; min-height: 100vh; background: #0a1628; border-right: 1px solid #1e3a5f; transition: width 0.3s; }
        .sidebar.collapsed { width: 72px; }
        .sidebar.collapsed .nav-text, .sidebar.collapsed .brand-text, .sidebar.collapsed .sidebar-section-label { display: none; }
        .sidebar.collapsed .nav-item { justify-content: center; padding: 12px 0; }
        .sidebar.collapsed .nav-item i { margin-right: 0; }
        .nav-item { display: flex; align-items: center; padding: 10px 20px; color: #94a3b8; text-decoration: none; border-radius: 8px; margin: 2px 12px; transition: all 0.2s; font-size: 0.9rem; }
        .nav-item:hover { background: #1e3a5f; color: #f59e0b; }
        .nav-item.active { background: #1e3a5f; color: #f59e0b; border-left: 3px solid #f59e0b; }
        .nav-item i { width: 20px; margin-right: 12px; text-align: center; }
        .sidebar-section-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.1em; color: #475569; padding: 16px 20px 4px; }
        .thread-item { padding: 14px 16px; border-bottom: 1px solid #1e3a5f; cursor: pointer; transition: all 0.2s; }
        .thread-item:hover { background: #1e3a5f; }
        .thread-item.active { background: #1e3a5f; border-left: 3px solid #f59e0b; }
        .message-bubble { max-width: 75%; padding: 10px 14px; border-radius: 12px; font-size: 0.9rem; line-height: 1.5; }
        .message-incoming { background: #1e3a5f; border-bottom-left-radius: 4px; }
        .message-outgoing { background: #ea580c; border-bottom-right-radius: 4px; }
        .online-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .online { background: #22c55e; }
        .offline { background: #64748b; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="safety-stripe"></div>
    <div class="flex">
        <!-- Sidebar -->
        <nav class="sidebar flex flex-col" id="sidebar">
            <div class="p-5 flex items-center justify-between border-b border-[#1e3a5f]">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 bg-gradient-to-br from-[#ea580c] to-[#f59e0b] rounded-lg flex items-center justify-center">
                        <i class="fas fa-microphone-lines text-white text-sm"></i>
                    </div>
                    <div class="brand-text">
                        <div class="text-sm font-bold text-white leading-tight">FieldVoice</div>
                        <div class="text-xs text-[#f59e0b] font-semibold">PRO ADMIN</div>
                    </div>
                </div>
                <button onclick="document.getElementById('sidebar').classList.toggle('collapsed')" class="text-[#64748b] hover:text-[#f59e0b] transition"><i class="fas fa-bars"></i></button>
            </div>
            <div class="flex-1 py-4">
                <div class="sidebar-section-label">Main</div>
                <a href="index.html" class="nav-item"><i class="fas fa-gauge-high"></i><span class="nav-text">Command Center</span></a>
                <a href="reports.html" class="nav-item"><i class="fas fa-file-lines"></i><span class="nav-text">Reports</span></a>
                <a href="messages.html" class="nav-item active"><i class="fas fa-comments"></i><span class="nav-text">Messages</span></a>
                <a href="photos.html" class="nav-item"><i class="fas fa-camera"></i><span class="nav-text">Photos</span></a>
                <a href="maps.html" class="nav-item"><i class="fas fa-map-location-dot"></i><span class="nav-text">Job Site Maps</span></a>
                <div class="sidebar-section-label">Operations</div>
                <a href="deliveries.html" class="nav-item"><i class="fas fa-truck"></i><span class="nav-text">Deliveries</span></a>
                <a href="calendar.html" class="nav-item"><i class="fas fa-calendar-days"></i><span class="nav-text">Calendar</span></a>
                <div class="sidebar-section-label">Intelligence</div>
                <a href="ai-insights.html" class="nav-item"><i class="fas fa-brain"></i><span class="nav-text">AI Insights</span></a>
                <a href="users.html" class="nav-item"><i class="fas fa-users-gear"></i><span class="nav-text">Users</span></a>
            </div>
            <div class="p-4 border-t border-[#1e3a5f]">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-[#ea580c] flex items-center justify-center text-white text-sm font-bold">JK</div>
                    <div class="nav-text"><div class="text-xs font-medium text-white">Jackson Koerner</div><div class="text-xs text-[#64748b]">Admin</div></div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 flex" style="height: calc(100vh - 6px);">
            <!-- Thread List -->
            <div class="w-80 border-r border-[#1e3a5f] flex flex-col bg-[#0a1628]">
                <div class="p-4 border-b border-[#1e3a5f]">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-lg font-bold text-white">Messages</h2>
                        <button class="bg-[#ea580c] hover:bg-[#dc2626] text-white px-3 py-1.5 rounded-lg text-xs font-medium transition" onclick="showBroadcast()">
                            <i class="fas fa-bullhorn mr-1"></i>Broadcast
                        </button>
                    </div>
                    <div class="relative">
                        <input type="text" placeholder="Search conversations..." class="w-full bg-[#1e3a5f] border border-[#2d4a6f] rounded-lg px-3 py-2 text-sm text-white placeholder-[#64748b] focus:outline-none focus:border-[#f59e0b]">
                        <i class="fas fa-search absolute right-3 top-2.5 text-[#64748b] text-sm"></i>
                    </div>
                </div>
                <div class="flex-1 overflow-auto" id="threadList">
                </div>
            </div>

            <!-- Chat View -->
            <div class="flex-1 flex flex-col bg-[#0f1d32]">
                <!-- Chat Header -->
                <div class="px-6 py-4 border-b border-[#1e3a5f] flex items-center justify-between" id="chatHeader">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-[#1e3a5f] flex items-center justify-center text-[#f59e0b] font-bold">NS</div>
                        <div>
                            <div class="text-sm font-semibold text-white" id="chatProjectName">N-S Connector Phase 2</div>
                            <div class="text-xs text-[#64748b]" id="chatParticipants">Jackson Koerner, Justin Cain â€¢ <span class="online-dot online pulse"></span> 2 online</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="p-2 text-[#64748b] hover:text-[#f59e0b] transition" title="Call"><i class="fas fa-phone"></i></button>
                        <button class="p-2 text-[#64748b] hover:text-[#f59e0b] transition" title="Pin"><i class="fas fa-thumbtack"></i></button>
                        <button class="p-2 text-[#64748b] hover:text-[#f59e0b] transition" title="More"><i class="fas fa-ellipsis-vertical"></i></button>
                    </div>
                </div>

                <!-- Messages Area -->
                <div class="flex-1 overflow-auto p-6 space-y-4" id="chatMessages">
                </div>

                <!-- Message Input -->
                <div class="p-4 border-t border-[#1e3a5f]">
                    <div class="flex items-center gap-3">
                        <button class="p-2 text-[#64748b] hover:text-[#f59e0b] transition"><i class="fas fa-paperclip"></i></button>
                        <button class="p-2 text-[#64748b] hover:text-[#f59e0b] transition"><i class="fas fa-camera"></i></button>
                        <input type="text" placeholder="Type a message..." class="flex-1 bg-[#1e3a5f] border border-[#2d4a6f] rounded-lg px-4 py-2.5 text-sm text-white placeholder-[#64748b] focus:outline-none focus:border-[#f59e0b]" id="messageInput" onkeypress="if(event.key==='Enter')sendMessage()">
                        <button class="bg-[#ea580c] hover:bg-[#dc2626] text-white px-4 py-2.5 rounded-lg transition" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Broadcast Modal -->
    <div class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 hidden" id="broadcastModal">
        <div class="bg-[#0a1628] border border-[#1e3a5f] rounded-xl w-[500px] p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-white"><i class="fas fa-bullhorn text-[#f59e0b] mr-2"></i>Broadcast Message</h3>
                <button onclick="closeBroadcast()" class="text-[#64748b] hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-sm text-[#94a3b8] block mb-1">Send to Project</label>
                    <select class="w-full bg-[#1e3a5f] border border-[#2d4a6f] rounded-lg px-3 py-2 text-sm text-white focus:outline-none">
                        <option>All Projects</option>
                        <option>N-S Connector Phase 2</option>
                        <option>CBIS Expansion</option>
                        <option>Express Shuttle Connector</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm text-[#94a3b8] block mb-1">Priority</label>
                    <div class="flex gap-2">
                        <button class="px-3 py-1.5 rounded-lg text-xs border border-[#1e3a5f] text-[#94a3b8] hover:border-[#22c55e] hover:text-[#22c55e]">Normal</button>
                        <button class="px-3 py-1.5 rounded-lg text-xs border border-[#f59e0b] text-[#f59e0b]">Urgent</button>
                        <button class="px-3 py-1.5 rounded-lg text-xs border border-[#1e3a5f] text-[#94a3b8] hover:border-[#ef4444] hover:text-[#ef4444]">Emergency</button>
                    </div>
                </div>
                <div>
                    <label class="text-sm text-[#94a3b8] block mb-1">Message</label>
                    <textarea rows="4" placeholder="Type your broadcast message..." class="w-full bg-[#1e3a5f] border border-[#2d4a6f] rounded-lg px-3 py-2 text-sm text-white placeholder-[#64748b] focus:outline-none focus:border-[#f59e0b] resize-none"></textarea>
                </div>
                <div class="flex justify-end gap-2">
                    <button onclick="closeBroadcast()" class="px-4 py-2 rounded-lg text-sm text-[#94a3b8] hover:text-white transition">Cancel</button>
                    <button onclick="closeBroadcast(); alert('Broadcast sent to all field users!')" class="bg-[#ea580c] hover:bg-[#dc2626] text-white px-4 py-2 rounded-lg text-sm font-medium transition"><i class="fas fa-paper-plane mr-1"></i>Send Broadcast</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const threads = [
            {
                id: 1, project: 'N-S Connector Phase 2', abbr: 'NS', color: '#ea580c', unread: 2,
                lastMessage: 'Kass Brothers confirmed 6-man crew for tomorrow storm drain',
                lastTime: '10:32 AM', online: true,
                messages: [
                    { from: 'Jackson Koerner', initials: 'JK', time: '8:15 AM', text: 'Good morning. Heading to N-S Connector now. Any updates on the Kass Brothers crew for today?', incoming: true },
                    { from: 'Admin', initials: 'AD', time: '8:18 AM', text: 'Morning Jackson. They confirmed 6-man crew, should be on site by 7:30. Focus on storm drain STA 8+25 eastbound.', incoming: false },
                    { from: 'Jackson Koerner', initials: 'JK', time: '8:22 AM', text: 'Copy that. Hunt Gibbs has the Cat 320 warming up already. I\'ll start my report once they get the first section of RCP in.', incoming: true },
                    { from: 'Admin', initials: 'AD', time: '9:45 AM', text: 'How\'s the pipe installation going? DOT wants an update on footage for the weekly.', incoming: false },
                    { from: 'Jackson Koerner', initials: 'JK', time: '9:52 AM', text: 'Going smooth. They\'ve got about 120 LF in so far, 24" Class III RCP. Bedding looks good, I\'m checking grade on every joint. Should hit 225 LF by end of day.', incoming: true },
                    { from: 'Jackson Koerner', initials: 'JK', time: '10:15 AM', text: 'ðŸ“¸ Sent 2 photos â€” trench excavation and pipe placement at STA 8+50', incoming: true },
                    { from: 'Admin', initials: 'AD', time: '10:20 AM', text: 'Great photos. Make sure you get the compaction test results before they backfill. Also, concrete delivery for the headwall is confirmed for Friday.', incoming: false },
                    { from: 'Jackson Koerner', initials: 'JK', time: '10:32 AM', text: 'Kass Brothers confirmed 6-man crew for tomorrow storm drain. Compaction tests are scheduled for 2 PM. Will send results as soon as I have them.', incoming: true },
                ]
            },
            {
                id: 2, project: 'CBIS Expansion', abbr: 'CB', color: '#3b82f6', unread: 0,
                lastMessage: 'All tickets verified. Pour complete. Finishing surface texture now.',
                lastTime: '9:48 AM', online: true,
                messages: [
                    { from: 'Justin Cain', initials: 'JC', time: '6:30 AM', text: 'On site for the pour today. Boh Bros setting up the pump truck now. Weather looks good â€” clear skies, 78Â°F.', incoming: true },
                    { from: 'Admin', initials: 'AD', time: '6:35 AM', text: 'Perfect pour weather. Make sure slump tests are documented for every load. FAA needs those for the record.', incoming: false },
                    { from: 'Justin Cain', initials: 'JC', time: '7:12 AM', text: 'First truck just arrived. Running slump test now... 4.5 inches, within spec. Air content 5.8%. Good to go.', incoming: true },
                    { from: 'Admin', initials: 'AD', time: '7:15 AM', text: 'ðŸ‘ Log every ticket number. How many trucks are they expecting?', incoming: false },
                    { from: 'Justin Cain', initials: 'JC', time: '7:20 AM', text: '6 trucks scheduled, 8 CY each. Should wrap up the 48 CY by early afternoon. Frischhertz is also here working on the conduit bank relocation.', incoming: true },
                    { from: 'Justin Cain', initials: 'JC', time: '8:45 AM', text: 'ðŸ“¸ Sent 4 photos â€” concrete placement STA 12+50, pump truck setup, rebar verification, slump test', incoming: true },
                    { from: 'Admin', initials: 'AD', time: '8:50 AM', text: 'Looking great. Remind Boh Bros about the texture finish spec â€” broom finish perpendicular to traffic.', incoming: false },
                    { from: 'Justin Cain', initials: 'JC', time: '9:48 AM', text: 'All tickets verified. Pour complete. Finishing surface texture now. Will have the full report with all QA data submitted by 3 PM.', incoming: true },
                ]
            },
            {
                id: 3, project: 'Express Shuttle Connector', abbr: 'ES', color: '#22c55e', unread: 1,
                lastMessage: 'Had some coordination issues with Peterson on the water main but sorted out now',
                lastTime: 'Yesterday', online: false,
                messages: [
                    { from: 'Andrew Stiebing', initials: 'AS', time: 'Yesterday 7:00 AM', text: 'Starting subgrade prep today. Lime spreader truck is on site. Going from STA 0+00 eastbound.', incoming: true },
                    { from: 'Admin', initials: 'AD', time: 'Yesterday 7:05 AM', text: 'Good. Double check the spread rate â€” spec calls for 50 lbs/SY. And keep an eye on Peterson Plumbing, they need to stay ahead of you on the water main.', incoming: false },
                    { from: 'Andrew Stiebing', initials: 'AS', time: 'Yesterday 8:30 AM', text: 'Spread rate verified at 50 lbs/SY. Peterson is here but they started in the wrong section. I\'m coordinating with their foreman to get them moved.', incoming: true },
                    { from: 'Admin', initials: 'AD', time: 'Yesterday 8:35 AM', text: 'Typical Peterson. Let me know if you need me to call their PM. What section should they be in?', incoming: false },
                    { from: 'Andrew Stiebing', initials: 'AS', time: 'Yesterday 9:15 AM', text: 'Got it sorted. They\'re relocating the 8" main from STA 2+00 to 4+50 now, which is where we need them. Compaction testing at 96.2% â€” we\'re good.', incoming: true },
                    { from: 'Andrew Stiebing', initials: 'AS', time: 'Yesterday 3:00 PM', text: 'Had some coordination issues with Peterson on the water main but sorted out now. Full report in the system. Made it to STA 4+50. Will pick up there tomorrow.', incoming: true },
                ]
            },
            {
                id: 4, project: 'Safety & QA/QC', abbr: 'QA', color: '#f59e0b', unread: 0,
                lastMessage: 'Weekly safety meeting moved to Thursday 7:00 AM at the field office',
                lastTime: 'Mon', online: false,
                messages: [
                    { from: 'Admin', initials: 'AD', time: 'Mon 2:00 PM', text: 'Reminder: Weekly toolbox safety talk this week covers trenching and excavation safety per OSHA 29 CFR 1926.652.', incoming: false },
                    { from: 'Jackson Koerner', initials: 'JK', time: 'Mon 2:15 PM', text: 'Good timing, we\'ve got active trenching on the N-S Connector. I\'ll make sure the Kass Brothers crew is there.', incoming: true },
                    { from: 'Justin Cain', initials: 'JC', time: 'Mon 2:20 PM', text: 'Copy. I\'ll be there. Also need to discuss the confined space entry procedures for the duct bank work.', incoming: true },
                    { from: 'Admin', initials: 'AD', time: 'Mon 3:00 PM', text: 'Weekly safety meeting moved to Thursday 7:00 AM at the field office. Updated the calendar.', incoming: false },
                ]
            }
        ];

        let activeThread = 0;

        function renderThreads() {
            const list = document.getElementById('threadList');
            list.innerHTML = threads.map((t, i) => `
                <div class="thread-item ${i === activeThread ? 'active' : ''}" onclick="selectThread(${i})">
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-bold" style="background:${t.color}">${t.abbr}</div>
                            <span class="absolute -bottom-0.5 -right-0.5 w-3 h-3 ${t.online ? 'bg-[#22c55e]' : 'bg-[#64748b]'} border-2 border-[#0a1628] rounded-full"></span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between">
                                <div class="text-sm font-medium text-white truncate">${t.project}</div>
                                <div class="text-xs text-[#64748b]">${t.lastTime}</div>
                            </div>
                            <div class="text-xs text-[#64748b] truncate mt-0.5">${t.lastMessage}</div>
                        </div>
                        ${t.unread > 0 ? `<div class="w-5 h-5 bg-[#ea580c] rounded-full flex items-center justify-center text-xs text-white font-bold">${t.unread}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function selectThread(i) {
            activeThread = i;
            const t = threads[i];
            document.getElementById('chatProjectName').textContent = t.project;
            document.getElementById('chatParticipants').innerHTML = t.messages.filter(m => m.incoming).map(m => m.from).filter((v, idx, a) => a.indexOf(v) === idx).join(', ') + ` â€¢ <span class="online-dot ${t.online ? 'online pulse' : 'offline'}"></span> ${t.online ? 'Online' : 'Offline'}`;
            renderMessages(t);
            renderThreads();
        }

        function renderMessages(t) {
            const container = document.getElementById('chatMessages');
            let lastDate = '';
            container.innerHTML = t.messages.map(m => {
                const time = m.time;
                let dateHeader = '';
                const datePart = time.includes('Yesterday') ? 'Yesterday' : time.includes('Mon') ? 'Monday' : 'Today';
                if (datePart !== lastDate) {
                    lastDate = datePart;
                    dateHeader = `<div class="text-center text-xs text-[#64748b] py-2"><span class="bg-[#1e3a5f] px-3 py-1 rounded-full">${datePart}</span></div>`;
                }
                return `
                    ${dateHeader}
                    <div class="flex ${m.incoming ? '' : 'justify-end'}">
                        <div class="flex items-end gap-2 ${m.incoming ? '' : 'flex-row-reverse'}">
                            <div class="w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${m.incoming ? 'bg-[#1e3a5f] text-[#94a3b8]' : 'bg-[#ea580c] text-white'}">${m.initials}</div>
                            <div>
                                ${m.incoming ? `<div class="text-xs text-[#64748b] mb-1">${m.from}</div>` : ''}
                                <div class="message-bubble ${m.incoming ? 'message-incoming' : 'message-outgoing'}">
                                    <div class="text-sm text-white">${m.text}</div>
                                </div>
                                <div class="text-xs text-[#475569] mt-1 ${m.incoming ? '' : 'text-right'}">${time.replace('Yesterday ', '').replace('Mon ', '')}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;
            const t = threads[activeThread];
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
            t.messages.push({ from: 'Admin', initials: 'AD', time: timeStr, text: text, incoming: false });
            t.lastMessage = text;
            t.lastTime = timeStr;
            input.value = '';
            renderMessages(t);
            renderThreads();
        }

        function showBroadcast() { document.getElementById('broadcastModal').classList.remove('hidden'); }
        function closeBroadcast() { document.getElementById('broadcastModal').classList.add('hidden'); }

        renderThreads();
        selectThread(0);
    </script>
</body>
</html>
